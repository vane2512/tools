<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIPPT - AIæ™ºèƒ½PPTç”Ÿæˆå™¨</title>
    <script src="https://cdn.jsdelivr.net/npm/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mammoth@1.6.0/mammoth.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-input: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border: #475569;
        }

        body {
            font-family: 'Noto Sans SC', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid var(--border);
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        /* Main Layout */
        .main-layout {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 30px;
        }

        @media (max-width: 1200px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        /* Panel Styles */
        .panel {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px;
            border: 1px solid var(--border);
        }

        .panel-title {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .panel-title svg {
            width: 24px;
            height: 24px;
            color: var(--primary);
        }

        /* Settings Button */
        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 100;
        }

        .settings-btn:hover {
            background: var(--bg-input);
            transform: scale(1.05);
        }

        .settings-btn svg {
            width: 24px;
            height: 24px;
            color: var(--text-primary);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            border: 1px solid var(--border);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-header h2 {
            font-size: 1.4rem;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--bg-input);
            color: var(--text-primary);
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 1rem;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            background: var(--bg-input);
            padding: 6px;
            border-radius: 12px;
        }

        .tab {
            flex: 1;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s;
        }

        .tab.active {
            background: var(--primary);
            color: white;
        }

        .tab:hover:not(.active) {
            background: rgba(99, 102, 241, 0.2);
            color: var(--text-primary);
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload:hover {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.1);
        }

        .file-upload svg {
            width: 48px;
            height: 48px;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        .file-upload p {
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .file-upload .formats {
            font-size: 0.85rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .file-upload input {
            display: none;
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border-radius: 10px;
            border: none;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(99, 102, 241, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: var(--bg-input);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--border);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-block {
            width: 100%;
        }

        /* Template Grid */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .template-card {
            background: var(--bg-input);
            border: 2px solid transparent;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .template-card:hover {
            border-color: var(--primary);
        }

        .template-card.active {
            border-color: var(--primary);
            background: rgba(99, 102, 241, 0.2);
        }

        .template-preview {
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .template-card .name {
            font-weight: 500;
            font-size: 0.9rem;
        }

        /* Color Picker Grid */
        .color-grid {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .color-option {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.active {
            border-color: white;
            box-shadow: 0 0 0 2px var(--primary);
        }

        /* Preview Area */
        .preview-area {
            min-height: 500px;
        }

        .slides-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .slide-wrapper {
            position: relative;
        }

        .slide-number {
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--primary);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .slide {
            width: 100%;
            aspect-ratio: 16/9;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            position: relative;
        }

        .slide-content {
            width: 100%;
            height: 100%;
            padding: 40px 50px;
            color: #1a1a2e;
            display: flex;
            flex-direction: column;
        }

        /* Slide Types */
        .slide-cover {
            justify-content: center;
            align-items: center;
            text-align: center;
        }

        .slide-cover h1 {
            font-size: 2.5rem;
            margin-bottom: 16px;
        }

        .slide-cover .subtitle {
            font-size: 1.3rem;
            opacity: 0.8;
        }

        .slide-content-page h2 {
            font-size: 1.8rem;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid;
        }

        .slide-content-page .points {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 16px;
        }

        .slide-content-page .point {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            font-size: 1.2rem;
        }

        .slide-content-page .point-icon {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            color: white;
            font-weight: bold;
        }

        /* Chart Slide */
        .slide-chart {
            display: flex;
            flex-direction: column;
        }

        .slide-chart h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
        }

        .chart-container {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-container canvas {
            max-height: 100%;
        }

        /* Table Slide */
        .slide-table table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .slide-table th,
        .slide-table td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        .slide-table th {
            font-weight: 600;
        }

        /* Timeline Slide */
        .timeline {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-top: 40px;
            position: relative;
        }

        .timeline::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 4px;
            background: #e0e0e0;
        }

        .timeline-item {
            flex: 1;
            text-align: center;
            position: relative;
            padding: 0 10px;
        }

        .timeline-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin: 0 auto 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            position: relative;
            z-index: 1;
        }

        .timeline-content h4 {
            font-size: 1rem;
            margin-bottom: 8px;
        }

        .timeline-content p {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        /* SmartArt Styles */
        .smartart-process {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .process-step {
            padding: 20px 30px;
            border-radius: 12px;
            color: white;
            font-weight: 500;
            text-align: center;
            min-width: 150px;
        }

        .process-arrow {
            font-size: 2rem;
            color: #ccc;
        }

        .smartart-hierarchy {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            margin-top: 30px;
        }

        .hierarchy-level {
            display: flex;
            gap: 20px;
            justify-content: center;
        }

        .hierarchy-item {
            padding: 16px 24px;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            text-align: center;
        }

        /* Export Buttons */
        .export-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .export-btn {
            padding: 14px 20px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 10px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            font-size: 0.95rem;
        }

        .export-btn:hover {
            background: var(--border);
            transform: translateY(-2px);
        }

        .export-btn svg {
            width: 20px;
            height: 20px;
        }

        /* Loading */
        .loading {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 60px;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading p {
            margin-top: 20px;
            color: var(--text-secondary);
        }

        /* Empty State */
        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 80px 40px;
            text-align: center;
        }

        .empty-state svg {
            width: 80px;
            height: 80px;
            color: var(--text-secondary);
            opacity: 0.5;
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.3rem;
            margin-bottom: 10px;
            color: var(--text-secondary);
        }

        .empty-state p {
            color: var(--text-secondary);
            opacity: 0.7;
        }

        /* Slide Navigation */
        .slide-nav {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px 0;
            margin-bottom: 20px;
        }

        .slide-thumb {
            width: 120px;
            height: 68px;
            background: var(--bg-input);
            border-radius: 8px;
            flex-shrink: 0;
            cursor: pointer;
            border: 2px solid transparent;
            overflow: hidden;
            transition: all 0.3s;
        }

        .slide-thumb:hover {
            border-color: var(--primary);
        }

        .slide-thumb.active {
            border-color: var(--primary);
        }

        .slide-thumb img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s;
            z-index: 2000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            border-color: var(--success);
        }

        .toast.error {
            border-color: var(--danger);
        }

        /* Slide Count Selector */
        .slide-count {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .slide-count label {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .slide-count input {
            width: 80px;
            padding: 8px 12px;
            background: var(--bg-input);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text-primary);
            text-align: center;
        }

        /* Actions */
        .actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        .actions .btn {
            flex: 1;
        }

        /* Progress */
        .progress-container {
            margin-top: 12px;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-bar {
            height: 6px;
            background: var(--bg-input);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-top: 8px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>AIPPT</h1>
            <p>AI æ™ºèƒ½ PPT ç”Ÿæˆå™¨ - è¾“å…¥å†…å®¹ï¼Œä¸€é”®ç”Ÿæˆä¸“ä¸šæ¼”ç¤ºæ–‡ç¨¿</p>
        </header>

        <button class="settings-btn" onclick="openSettings()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
        </button>

        <div class="main-layout">
            <!-- Left Panel - Input -->
            <div class="left-panel">
                <div class="panel">
                    <h2 class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                        </svg>
                        å†…å®¹è¾“å…¥
                    </h2>

                    <div class="tabs">
                        <button class="tab active" data-mode="topic" onclick="switchMode('topic')">ä¸»é¢˜</button>
                        <button class="tab" data-mode="outline" onclick="switchMode('outline')">å¤§çº²</button>
                        <button class="tab" data-mode="content" onclick="switchMode('content')">å†…å®¹</button>
                        <button class="tab" data-mode="file" onclick="switchMode('file')">æ–‡ä»¶</button>
                    </div>

                    <!-- Topic Mode -->
                    <div id="mode-topic" class="mode-content">
                        <div class="form-group">
                            <label>PPT ä¸»é¢˜</label>
                            <input type="text" id="topic-input" placeholder="ä¾‹å¦‚ï¼šæ–°èƒ½æºæ±½è½¦å¸‚åœºåˆ†ææŠ¥å‘Š">
                        </div>
                        <div class="slide-count">
                            <label>å¹»ç¯ç‰‡æ•°é‡ï¼š</label>
                            <input type="number" id="slide-count" value="10" min="5" max="30">
                        </div>
                    </div>

                    <!-- Outline Mode -->
                    <div id="mode-outline" class="mode-content" style="display:none;">
                        <div class="form-group">
                            <label>PPT å¤§çº²ï¼ˆæ¯è¡Œä¸€ä¸ªæ ‡é¢˜ï¼‰</label>
                            <textarea id="outline-input" placeholder="å°é¢ï¼šæ–°èƒ½æºæ±½è½¦å¸‚åœºåˆ†æ&#10;å¸‚åœºæ¦‚è¿°&#10;å‘å±•ç°çŠ¶&#10;ç«äº‰æ ¼å±€&#10;æœªæ¥è¶‹åŠ¿&#10;æ€»ç»“ä¸å»ºè®®"></textarea>
                        </div>
                    </div>

                    <!-- Content Mode -->
                    <div id="mode-content" class="mode-content" style="display:none;">
                        <div class="form-group">
                            <label>è¯¦ç»†å†…å®¹</label>
                            <textarea id="content-input" placeholder="åœ¨æ­¤ç²˜è´´æ‚¨çš„å®Œæ•´å†…å®¹ï¼ŒAI å°†è‡ªåŠ¨åˆ†é¡µå’Œæ’ç‰ˆ..."></textarea>
                        </div>
                    </div>

                    <!-- File Mode -->
                    <div id="mode-file" class="mode-content" style="display:none;">
                        <div class="file-upload" onclick="document.getElementById('file-input').click()">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <p>ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„</p>
                            <span class="formats">æ”¯æŒ TXTã€Markdownã€Word æ–‡ä»¶</span>
                            <input type="file" id="file-input" accept=".txt,.md,.docx" onchange="handleFileUpload(event)">
                        </div>
                        <div id="file-preview" style="display:none; margin-top: 16px;">
                            <div class="form-group">
                                <label>æ–‡ä»¶å†…å®¹é¢„è§ˆ</label>
                                <textarea id="file-content" readonly></textarea>
                            </div>
                        </div>
                    </div>

                    <div class="actions">
                        <button class="btn btn-primary btn-block" onclick="generatePPT()">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="20" height="20">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            ç”Ÿæˆ PPT
                        </button>
                    </div>

                    <div class="progress-container" id="progress">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <p class="progress-text" id="progress-text">æ­£åœ¨ç”Ÿæˆ...</p>
                    </div>
                </div>

                <!-- Style Panel -->
                <div class="panel" style="margin-top: 20px;">
                    <h2 class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                        </svg>
                        é£æ ¼è®¾ç½®
                    </h2>

                    <label style="display:block; margin-bottom: 12px; color: var(--text-secondary); font-size: 0.9rem;">é€‰æ‹©æ¨¡æ¿</label>
                    <div class="template-grid">
                        <div class="template-card active" data-template="business" onclick="selectTemplate('business')">
                            <div class="template-preview" style="background: linear-gradient(135deg, #1e3a5f, #2d5a87);">ğŸ“Š</div>
                            <span class="name">å•†åŠ¡è“</span>
                        </div>
                        <div class="template-card" data-template="tech" onclick="selectTemplate('tech')">
                            <div class="template-preview" style="background: linear-gradient(135deg, #0f172a, #6366f1);">ğŸ’»</div>
                            <span class="name">ç§‘æŠ€ç´«</span>
                        </div>
                        <div class="template-card" data-template="nature" onclick="selectTemplate('nature')">
                            <div class="template-preview" style="background: linear-gradient(135deg, #065f46, #10b981);">ğŸŒ¿</div>
                            <span class="name">è‡ªç„¶ç»¿</span>
                        </div>
                        <div class="template-card" data-template="warm" onclick="selectTemplate('warm')">
                            <div class="template-preview" style="background: linear-gradient(135deg, #9a3412, #f59e0b);">ğŸ”¥</div>
                            <span class="name">æš–è‰²æ©™</span>
                        </div>
                        <div class="template-card" data-template="minimal" onclick="selectTemplate('minimal')">
                            <div class="template-preview" style="background: linear-gradient(135deg, #f8fafc, #e2e8f0); color: #1e293b;">âœ¨</div>
                            <span class="name">ç®€çº¦ç™½</span>
                        </div>
                        <div class="template-card" data-template="dark" onclick="selectTemplate('dark')">
                            <div class="template-preview" style="background: linear-gradient(135deg, #18181b, #3f3f46);">ğŸŒ™</div>
                            <span class="name">æš—é»‘é£</span>
                        </div>
                    </div>

                    <label style="display:block; margin-bottom: 12px; color: var(--text-secondary); font-size: 0.9rem;">ä¸»é¢˜è‰²</label>
                    <div class="color-grid">
                        <div class="color-option active" style="background: #6366f1;" data-color="#6366f1" onclick="selectColor('#6366f1')"></div>
                        <div class="color-option" style="background: #3b82f6;" data-color="#3b82f6" onclick="selectColor('#3b82f6')"></div>
                        <div class="color-option" style="background: #10b981;" data-color="#10b981" onclick="selectColor('#10b981')"></div>
                        <div class="color-option" style="background: #f59e0b;" data-color="#f59e0b" onclick="selectColor('#f59e0b')"></div>
                        <div class="color-option" style="background: #ef4444;" data-color="#ef4444" onclick="selectColor('#ef4444')"></div>
                        <div class="color-option" style="background: #8b5cf6;" data-color="#8b5cf6" onclick="selectColor('#8b5cf6')"></div>
                        <div class="color-option" style="background: #ec4899;" data-color="#ec4899" onclick="selectColor('#ec4899')"></div>
                        <div class="color-option" style="background: #14b8a6;" data-color="#14b8a6" onclick="selectColor('#14b8a6')"></div>
                    </div>
                </div>

                <!-- Export Panel -->
                <div class="panel" style="margin-top: 20px;" id="export-panel">
                    <h2 class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                        </svg>
                        å¯¼å‡º
                    </h2>

                    <div class="export-buttons">
                        <button class="export-btn" onclick="exportPPTX()" id="btn-pptx" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                            </svg>
                            PPTX
                        </button>
                        <button class="export-btn" onclick="exportPDF()" id="btn-pdf" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                            PDF
                        </button>
                        <button class="export-btn" onclick="exportImages()" id="btn-images" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            å›¾ç‰‡
                        </button>
                        <button class="export-btn" onclick="exportHTML()" id="btn-html" disabled>
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" />
                            </svg>
                            HTML
                        </button>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Preview -->
            <div class="right-panel">
                <div class="panel preview-area">
                    <h2 class="panel-title">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                        </svg>
                        é¢„è§ˆ
                    </h2>

                    <div id="slides-nav" class="slide-nav" style="display: none;"></div>

                    <div id="empty-state" class="empty-state">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                        </svg>
                        <h3>å¼€å§‹åˆ›å»ºæ‚¨çš„ PPT</h3>
                        <p>è¾“å…¥ä¸»é¢˜æˆ–å†…å®¹ï¼ŒAI å°†ä¸ºæ‚¨ç”Ÿæˆä¸“ä¸šçš„æ¼”ç¤ºæ–‡ç¨¿</p>
                    </div>

                    <div id="loading" class="loading">
                        <div class="spinner"></div>
                        <p id="loading-text">AI æ­£åœ¨ç”Ÿæˆå†…å®¹...</p>
                    </div>

                    <div id="slides-container" class="slides-container"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h2>API è®¾ç½®</h2>
                <button class="modal-close" onclick="closeSettings()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" width="24" height="24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="form-group">
                <label>API Base URL</label>
                <input type="text" id="api-url" placeholder="https://api.example.com/v1">
            </div>
            <div class="form-group">
                <label>API Key</label>
                <input type="password" id="api-key" placeholder="sk-...">
            </div>
            <div class="form-group">
                <label>æ¨¡å‹</label>
                <select id="api-model">
                    <option value="claude-sonnet-4-20250514">Claude Sonnet 4</option>
                    <option value="claude-3-5-sonnet-20241022">Claude 3.5 Sonnet</option>
                    <option value="claude-3-opus-20240229">Claude 3 Opus</option>
                    <option value="claude-3-haiku-20240307">Claude 3 Haiku</option>
                    <option value="gpt-4o">GPT-4o</option>
                    <option value="gpt-4-turbo">GPT-4 Turbo</option>
                    <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                </select>
            </div>
            <button class="btn btn-primary btn-block" onclick="saveSettings()">ä¿å­˜è®¾ç½®</button>
        </div>
    </div>

    <!-- Toast -->
    <div class="toast" id="toast">
        <span id="toast-message"></span>
    </div>

    <script>
        // Global state
        let currentMode = 'topic';
        let currentTemplate = 'business';
        let currentColor = '#6366f1';
        let slidesData = [];
        let charts = [];

        // Templates configuration
        const templates = {
            business: {
                name: 'å•†åŠ¡è“',
                bgColor: '#ffffff',
                titleBg: 'linear-gradient(135deg, #1e3a5f, #2d5a87)',
                accentColor: '#1e3a5f',
                textColor: '#1a1a2e'
            },
            tech: {
                name: 'ç§‘æŠ€ç´«',
                bgColor: '#0f172a',
                titleBg: 'linear-gradient(135deg, #4f46e5, #7c3aed)',
                accentColor: '#6366f1',
                textColor: '#f1f5f9'
            },
            nature: {
                name: 'è‡ªç„¶ç»¿',
                bgColor: '#ffffff',
                titleBg: 'linear-gradient(135deg, #065f46, #10b981)',
                accentColor: '#059669',
                textColor: '#1a1a2e'
            },
            warm: {
                name: 'æš–è‰²æ©™',
                bgColor: '#fffbeb',
                titleBg: 'linear-gradient(135deg, #9a3412, #f59e0b)',
                accentColor: '#d97706',
                textColor: '#1a1a2e'
            },
            minimal: {
                name: 'ç®€çº¦ç™½',
                bgColor: '#ffffff',
                titleBg: 'linear-gradient(135deg, #f8fafc, #e2e8f0)',
                accentColor: '#64748b',
                textColor: '#1e293b'
            },
            dark: {
                name: 'æš—é»‘é£',
                bgColor: '#18181b',
                titleBg: 'linear-gradient(135deg, #27272a, #3f3f46)',
                accentColor: '#a1a1aa',
                textColor: '#fafafa'
            }
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
        });

        // Settings management
        function loadSettings() {
            const settings = JSON.parse(localStorage.getItem('aippt-settings') || '{}');
            document.getElementById('api-url').value = settings.apiUrl || 'https://tik2i1kw.cn-nb1.rainapp.top/api';
            document.getElementById('api-key').value = settings.apiKey || '';
            document.getElementById('api-model').value = settings.model || 'claude-sonnet-4-20250514';
        }

        function saveSettings() {
            const settings = {
                apiUrl: document.getElementById('api-url').value,
                apiKey: document.getElementById('api-key').value,
                model: document.getElementById('api-model').value
            };
            localStorage.setItem('aippt-settings', JSON.stringify(settings));
            closeSettings();
            showToast('è®¾ç½®å·²ä¿å­˜', 'success');
        }

        function openSettings() {
            document.getElementById('settings-modal').classList.add('active');
        }

        function closeSettings() {
            document.getElementById('settings-modal').classList.remove('active');
        }

        // Mode switching
        function switchMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });
            document.querySelectorAll('.mode-content').forEach(content => {
                content.style.display = 'none';
            });
            document.getElementById(`mode-${mode}`).style.display = 'block';
        }

        // Template selection
        function selectTemplate(template) {
            currentTemplate = template;
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.toggle('active', card.dataset.template === template);
            });
            if (slidesData.length > 0) {
                renderSlides();
            }
        }

        // Color selection
        function selectColor(color) {
            currentColor = color;
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.toggle('active', option.dataset.color === color);
            });
            if (slidesData.length > 0) {
                renderSlides();
            }
        }

        // File upload handling
        async function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            let content = '';
            const fileName = file.name.toLowerCase();

            try {
                if (fileName.endsWith('.txt') || fileName.endsWith('.md')) {
                    content = await file.text();
                } else if (fileName.endsWith('.docx')) {
                    const arrayBuffer = await file.arrayBuffer();
                    const result = await mammoth.extractRawText({ arrayBuffer });
                    content = result.value;
                }

                document.getElementById('file-content').value = content;
                document.getElementById('file-preview').style.display = 'block';
                showToast('æ–‡ä»¶å·²åŠ è½½', 'success');
            } catch (error) {
                showToast('æ–‡ä»¶è¯»å–å¤±è´¥: ' + error.message, 'error');
            }
        }

        // Generate PPT
        async function generatePPT() {
            const settings = JSON.parse(localStorage.getItem('aippt-settings') || '{}');
            if (!settings.apiKey) {
                openSettings();
                showToast('è¯·å…ˆé…ç½® API Key', 'error');
                return;
            }

            let inputContent = '';
            let promptType = '';

            switch (currentMode) {
                case 'topic':
                    inputContent = document.getElementById('topic-input').value;
                    promptType = 'topic';
                    break;
                case 'outline':
                    inputContent = document.getElementById('outline-input').value;
                    promptType = 'outline';
                    break;
                case 'content':
                    inputContent = document.getElementById('content-input').value;
                    promptType = 'content';
                    break;
                case 'file':
                    inputContent = document.getElementById('file-content').value;
                    promptType = 'content';
                    break;
            }

            if (!inputContent.trim()) {
                showToast('è¯·è¾“å…¥å†…å®¹', 'error');
                return;
            }

            showLoading(true);
            updateProgress(10, 'AI æ­£åœ¨åˆ†æå†…å®¹...');

            try {
                const slideCount = document.getElementById('slide-count')?.value || 10;
                const prompt = buildPrompt(promptType, inputContent, slideCount);

                updateProgress(30, 'AI æ­£åœ¨ç”Ÿæˆå¹»ç¯ç‰‡ç»“æ„...');

                const response = await callAPI(settings, prompt);

                updateProgress(70, 'æ­£åœ¨è§£æç”Ÿæˆç»“æœ...');

                slidesData = parseResponse(response);

                updateProgress(90, 'æ­£åœ¨æ¸²æŸ“é¢„è§ˆ...');

                renderSlides();
                enableExportButtons();

                updateProgress(100, 'å®Œæˆ!');
                setTimeout(() => showLoading(false), 500);

                showToast(`æˆåŠŸç”Ÿæˆ ${slidesData.length} é¡µå¹»ç¯ç‰‡`, 'success');
            } catch (error) {
                console.error('Generation error:', error);
                showLoading(false);
                showToast('ç”Ÿæˆå¤±è´¥: ' + error.message, 'error');
            }
        }

        function buildPrompt(type, content, slideCount) {
            const basePrompt = `ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„PPTå†…å®¹ç”Ÿæˆä¸“å®¶ã€‚è¯·æ ¹æ®ç”¨æˆ·æä¾›çš„${type === 'topic' ? 'ä¸»é¢˜' : type === 'outline' ? 'å¤§çº²' : 'å†…å®¹'}ï¼Œç”Ÿæˆä¸€ä»½ä¸“ä¸šçš„PPTç»“æ„ã€‚

è¦æ±‚ï¼š
1. ç”Ÿæˆçº¦ ${slideCount} é¡µå¹»ç¯ç‰‡
2. åŒ…å«å°é¢é¡µã€ç›®å½•é¡µã€å†…å®¹é¡µå’Œç»“æŸé¡µ
3. å†…å®¹é¡µç±»å‹å¯ä»¥åŒ…æ‹¬ï¼šæ™®é€šæ–‡å­—é¡µã€åˆ—è¡¨é¡µã€å›¾è¡¨é¡µï¼ˆæŸ±çŠ¶å›¾/é¥¼å›¾/æŠ˜çº¿å›¾ï¼‰ã€è¡¨æ ¼é¡µã€æ—¶é—´çº¿é¡µã€æµç¨‹å›¾é¡µ
4. æ¯é¡µå†…å®¹è¦ç²¾ç‚¼ï¼Œæ¯ä¸ªè¦ç‚¹ä¸è¶…è¿‡20ä¸ªå­—
5. å›¾è¡¨æ•°æ®è¦åˆç†çœŸå®

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹JSONæ ¼å¼è¿”å›ï¼Œä¸è¦æœ‰ä»»ä½•å…¶ä»–æ–‡å­—ï¼š

{
  "title": "PPTæ ‡é¢˜",
  "slides": [
    {
      "type": "cover",
      "title": "ä¸»æ ‡é¢˜",
      "subtitle": "å‰¯æ ‡é¢˜"
    },
    {
      "type": "toc",
      "title": "ç›®å½•",
      "items": ["ç« èŠ‚1", "ç« èŠ‚2", "ç« èŠ‚3"]
    },
    {
      "type": "content",
      "title": "é¡µé¢æ ‡é¢˜",
      "points": ["è¦ç‚¹1", "è¦ç‚¹2", "è¦ç‚¹3", "è¦ç‚¹4"]
    },
    {
      "type": "chart",
      "title": "å›¾è¡¨æ ‡é¢˜",
      "chartType": "bar|pie|line",
      "data": {
        "labels": ["æ ‡ç­¾1", "æ ‡ç­¾2", "æ ‡ç­¾3"],
        "values": [30, 50, 20],
        "label": "æ•°æ®ç³»åˆ—åç§°"
      }
    },
    {
      "type": "table",
      "title": "è¡¨æ ¼æ ‡é¢˜",
      "headers": ["åˆ—1", "åˆ—2", "åˆ—3"],
      "rows": [
        ["æ•°æ®1", "æ•°æ®2", "æ•°æ®3"],
        ["æ•°æ®4", "æ•°æ®5", "æ•°æ®6"]
      ]
    },
    {
      "type": "timeline",
      "title": "æ—¶é—´çº¿æ ‡é¢˜",
      "events": [
        {"time": "2020", "title": "äº‹ä»¶1", "desc": "æè¿°"},
        {"time": "2021", "title": "äº‹ä»¶2", "desc": "æè¿°"}
      ]
    },
    {
      "type": "process",
      "title": "æµç¨‹æ ‡é¢˜",
      "steps": ["æ­¥éª¤1", "æ­¥éª¤2", "æ­¥éª¤3", "æ­¥éª¤4"]
    },
    {
      "type": "end",
      "title": "è°¢è°¢è§‚çœ‹",
      "subtitle": "è”ç³»æ–¹å¼æˆ–ç»“æŸè¯­"
    }
  ]
}`;

            return `${basePrompt}\n\nç”¨æˆ·è¾“å…¥çš„${type === 'topic' ? 'ä¸»é¢˜' : type === 'outline' ? 'å¤§çº²' : 'å†…å®¹'}ï¼š\n${content}`;
        }

        async function callAPI(settings, prompt) {
            const isAnthropic = settings.model.startsWith('claude');

            let requestBody, headers;

            if (isAnthropic) {
                headers = {
                    'Content-Type': 'application/json',
                    'x-api-key': settings.apiKey,
                    'anthropic-version': '2023-06-01'
                };
                requestBody = {
                    model: settings.model,
                    max_tokens: 8192,
                    messages: [{ role: 'user', content: prompt }]
                };
            } else {
                headers = {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${settings.apiKey}`
                };
                requestBody = {
                    model: settings.model,
                    messages: [{ role: 'user', content: prompt }],
                    max_tokens: 8192
                };
            }

            const apiUrl = isAnthropic
                ? `${settings.apiUrl}/messages`
                : `${settings.apiUrl}/chat/completions`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers,
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                const error = await response.text();
                throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status} - ${error}`);
            }

            const data = await response.json();

            if (isAnthropic) {
                return data.content[0].text;
            } else {
                return data.choices[0].message.content;
            }
        }

        function parseResponse(response) {
            // Extract JSON from response
            let jsonStr = response;
            const jsonMatch = response.match(/\{[\s\S]*\}/);
            if (jsonMatch) {
                jsonStr = jsonMatch[0];
            }

            try {
                const data = JSON.parse(jsonStr);
                return data.slides || [];
            } catch (e) {
                console.error('JSON parse error:', e);
                throw new Error('AI è¿”å›çš„æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é‡è¯•');
            }
        }

        // Render slides
        function renderSlides() {
            const container = document.getElementById('slides-container');
            const nav = document.getElementById('slides-nav');
            const emptyState = document.getElementById('empty-state');

            // Clear existing charts
            charts.forEach(chart => chart.destroy());
            charts = [];

            container.innerHTML = '';
            nav.innerHTML = '';
            emptyState.style.display = 'none';
            nav.style.display = 'flex';

            const template = templates[currentTemplate];
            const accent = currentColor;

            slidesData.forEach((slide, index) => {
                const slideWrapper = document.createElement('div');
                slideWrapper.className = 'slide-wrapper';
                slideWrapper.id = `slide-${index}`;

                const slideNumber = document.createElement('div');
                slideNumber.className = 'slide-number';
                slideNumber.textContent = `${index + 1} / ${slidesData.length}`;

                const slideEl = document.createElement('div');
                slideEl.className = 'slide';
                slideEl.style.background = template.bgColor;

                const content = document.createElement('div');
                content.className = 'slide-content';
                content.style.color = template.textColor;

                switch (slide.type) {
                    case 'cover':
                        content.classList.add('slide-cover');
                        content.style.background = template.titleBg;
                        content.style.color = '#ffffff';
                        content.innerHTML = `
                            <h1>${slide.title || ''}</h1>
                            <p class="subtitle">${slide.subtitle || ''}</p>
                        `;
                        break;

                    case 'toc':
                        content.classList.add('slide-content-page');
                        content.innerHTML = `
                            <h2 style="border-color: ${accent}">${slide.title || 'ç›®å½•'}</h2>
                            <div class="points">
                                ${(slide.items || []).map((item, i) => `
                                    <div class="point">
                                        <div class="point-icon" style="background: ${accent}">${i + 1}</div>
                                        <span>${item}</span>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;

                    case 'content':
                        content.classList.add('slide-content-page');
                        content.innerHTML = `
                            <h2 style="border-color: ${accent}">${slide.title || ''}</h2>
                            <div class="points">
                                ${(slide.points || []).map((point, i) => `
                                    <div class="point">
                                        <div class="point-icon" style="background: ${accent}">âœ“</div>
                                        <span>${point}</span>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;

                    case 'chart':
                        content.classList.add('slide-chart');
                        const canvasId = `chart-${index}`;
                        content.innerHTML = `
                            <h2 style="border-bottom: 3px solid ${accent}; padding-bottom: 15px;">${slide.title || ''}</h2>
                            <div class="chart-container">
                                <canvas id="${canvasId}"></canvas>
                            </div>
                        `;
                        slideEl.appendChild(content);
                        slideWrapper.appendChild(slideNumber);
                        slideWrapper.appendChild(slideEl);
                        container.appendChild(slideWrapper);

                        // Render chart after DOM is ready
                        setTimeout(() => {
                            renderChart(canvasId, slide.chartType, slide.data, accent);
                        }, 100);

                        addNavThumb(nav, index);
                        return;

                    case 'table':
                        content.classList.add('slide-table');
                        content.innerHTML = `
                            <h2 style="border-bottom: 3px solid ${accent}; padding-bottom: 15px;">${slide.title || ''}</h2>
                            <table>
                                <thead>
                                    <tr style="background: ${accent}; color: white;">
                                        ${(slide.headers || []).map(h => `<th>${h}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${(slide.rows || []).map((row, i) => `
                                        <tr style="background: ${i % 2 === 0 ? 'transparent' : 'rgba(0,0,0,0.03)'}">
                                            ${row.map(cell => `<td>${cell}</td>`).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        `;
                        break;

                    case 'timeline':
                        content.innerHTML = `
                            <h2 style="border-bottom: 3px solid ${accent}; padding-bottom: 15px;">${slide.title || ''}</h2>
                            <div class="timeline">
                                ${(slide.events || []).map((event, i) => `
                                    <div class="timeline-item">
                                        <div class="timeline-dot" style="background: ${accent}">${event.time}</div>
                                        <div class="timeline-content">
                                            <h4>${event.title}</h4>
                                            <p>${event.desc || ''}</p>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `;
                        break;

                    case 'process':
                        content.innerHTML = `
                            <h2 style="border-bottom: 3px solid ${accent}; padding-bottom: 15px;">${slide.title || ''}</h2>
                            <div class="smartart-process">
                                ${(slide.steps || []).map((step, i) => `
                                    ${i > 0 ? '<span class="process-arrow">â†’</span>' : ''}
                                    <div class="process-step" style="background: ${accent}">${step}</div>
                                `).join('')}
                            </div>
                        `;
                        break;

                    case 'end':
                        content.classList.add('slide-cover');
                        content.style.background = template.titleBg;
                        content.style.color = '#ffffff';
                        content.innerHTML = `
                            <h1>${slide.title || 'è°¢è°¢è§‚çœ‹'}</h1>
                            <p class="subtitle">${slide.subtitle || ''}</p>
                        `;
                        break;

                    default:
                        content.classList.add('slide-content-page');
                        content.innerHTML = `<h2>${slide.title || ''}</h2>`;
                }

                slideEl.appendChild(content);
                slideWrapper.appendChild(slideNumber);
                slideWrapper.appendChild(slideEl);
                container.appendChild(slideWrapper);

                addNavThumb(nav, index);
            });
        }

        function addNavThumb(nav, index) {
            const thumb = document.createElement('div');
            thumb.className = 'slide-thumb';
            thumb.textContent = index + 1;
            thumb.style.display = 'flex';
            thumb.style.alignItems = 'center';
            thumb.style.justifyContent = 'center';
            thumb.style.fontSize = '0.9rem';
            thumb.style.color = 'var(--text-secondary)';
            thumb.onclick = () => {
                document.getElementById(`slide-${index}`).scrollIntoView({ behavior: 'smooth' });
            };
            nav.appendChild(thumb);
        }

        function renderChart(canvasId, chartType, data, accent) {
            const canvas = document.getElementById(canvasId);
            if (!canvas) return;

            const ctx = canvas.getContext('2d');

            const colors = [
                accent,
                adjustColor(accent, 30),
                adjustColor(accent, -30),
                adjustColor(accent, 60),
                adjustColor(accent, -60)
            ];

            const chartConfig = {
                type: chartType === 'pie' ? 'pie' : chartType === 'line' ? 'line' : 'bar',
                data: {
                    labels: data.labels || [],
                    datasets: [{
                        label: data.label || 'æ•°æ®',
                        data: data.values || [],
                        backgroundColor: chartType === 'pie' ? colors : accent,
                        borderColor: chartType === 'line' ? accent : 'transparent',
                        borderWidth: chartType === 'line' ? 3 : 0,
                        fill: chartType === 'line' ? false : true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: chartType === 'pie' ? 'right' : 'top'
                        }
                    },
                    scales: chartType === 'pie' ? {} : {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };

            const chart = new Chart(ctx, chartConfig);
            charts.push(chart);
        }

        function adjustColor(color, amount) {
            const hex = color.replace('#', '');
            const r = Math.max(0, Math.min(255, parseInt(hex.substr(0, 2), 16) + amount));
            const g = Math.max(0, Math.min(255, parseInt(hex.substr(2, 2), 16) + amount));
            const b = Math.max(0, Math.min(255, parseInt(hex.substr(4, 2), 16) + amount));
            return `#${r.toString(16).padStart(2, '0')}${g.toString(16).padStart(2, '0')}${b.toString(16).padStart(2, '0')}`;
        }

        // Export functions
        function enableExportButtons() {
            document.getElementById('btn-pptx').disabled = false;
            document.getElementById('btn-pdf').disabled = false;
            document.getElementById('btn-images').disabled = false;
            document.getElementById('btn-html').disabled = false;
        }

        async function exportPPTX() {
            showToast('æ­£åœ¨ç”Ÿæˆ PPTX...', 'success');

            const pptx = new PptxGenJS();
            const template = templates[currentTemplate];
            const accent = currentColor;

            // Set presentation properties
            pptx.layout = 'LAYOUT_16x9';
            pptx.title = slidesData[0]?.title || 'Presentation';

            for (const slide of slidesData) {
                const pptSlide = pptx.addSlide();

                // Set background
                if (slide.type === 'cover' || slide.type === 'end') {
                    pptSlide.background = { color: accent.replace('#', '') };
                } else {
                    pptSlide.background = { color: template.bgColor.replace('#', '') };
                }

                switch (slide.type) {
                    case 'cover':
                    case 'end':
                        pptSlide.addText(slide.title || '', {
                            x: 0.5, y: '40%', w: '90%', h: 1,
                            fontSize: 44, bold: true, color: 'FFFFFF',
                            align: 'center'
                        });
                        pptSlide.addText(slide.subtitle || '', {
                            x: 0.5, y: '55%', w: '90%', h: 0.5,
                            fontSize: 24, color: 'FFFFFF',
                            align: 'center'
                        });
                        break;

                    case 'toc':
                    case 'content':
                        pptSlide.addText(slide.title || '', {
                            x: 0.5, y: 0.3, w: '90%', h: 0.8,
                            fontSize: 32, bold: true,
                            color: template.textColor.replace('#', '')
                        });

                        const items = slide.items || slide.points || [];
                        items.forEach((item, i) => {
                            pptSlide.addText(item, {
                                x: 0.8, y: 1.5 + i * 0.7, w: '85%', h: 0.5,
                                fontSize: 20,
                                color: template.textColor.replace('#', ''),
                                bullet: { type: 'bullet', color: accent.replace('#', '') }
                            });
                        });
                        break;

                    case 'chart':
                        pptSlide.addText(slide.title || '', {
                            x: 0.5, y: 0.3, w: '90%', h: 0.8,
                            fontSize: 32, bold: true,
                            color: template.textColor.replace('#', '')
                        });

                        const chartType = slide.chartType === 'pie' ? 'pie' :
                                         slide.chartType === 'line' ? 'line' : 'bar';

                        pptSlide.addChart(pptx.ChartType[chartType], [{
                            name: slide.data?.label || 'Data',
                            labels: slide.data?.labels || [],
                            values: slide.data?.values || []
                        }], {
                            x: 1, y: 1.5, w: 8, h: 4,
                            chartColors: [accent.replace('#', '')],
                            showLegend: true,
                            legendPos: 'r'
                        });
                        break;

                    case 'table':
                        pptSlide.addText(slide.title || '', {
                            x: 0.5, y: 0.3, w: '90%', h: 0.8,
                            fontSize: 32, bold: true,
                            color: template.textColor.replace('#', '')
                        });

                        const tableData = [slide.headers || [], ...(slide.rows || [])];
                        pptSlide.addTable(tableData, {
                            x: 0.5, y: 1.5, w: 9, h: 3,
                            fontSize: 14,
                            color: template.textColor.replace('#', ''),
                            border: { pt: 1, color: 'CCCCCC' },
                            fill: { color: 'FFFFFF' }
                        });
                        break;

                    case 'timeline':
                    case 'process':
                        pptSlide.addText(slide.title || '', {
                            x: 0.5, y: 0.3, w: '90%', h: 0.8,
                            fontSize: 32, bold: true,
                            color: template.textColor.replace('#', '')
                        });

                        const steps = slide.steps || (slide.events || []).map(e => e.title);
                        const stepWidth = 8 / steps.length;

                        steps.forEach((step, i) => {
                            pptSlide.addShape('rect', {
                                x: 0.5 + i * stepWidth + 0.1, y: 2.5,
                                w: stepWidth - 0.2, h: 1,
                                fill: { color: accent.replace('#', '') }
                            });
                            pptSlide.addText(step, {
                                x: 0.5 + i * stepWidth + 0.1, y: 2.5,
                                w: stepWidth - 0.2, h: 1,
                                fontSize: 14, color: 'FFFFFF',
                                align: 'center', valign: 'middle'
                            });
                        });
                        break;
                }
            }

            const fileName = `${slidesData[0]?.title || 'presentation'}.pptx`;
            await pptx.writeFile({ fileName });
            showToast('PPTX å¯¼å‡ºæˆåŠŸ!', 'success');
        }

        async function exportPDF() {
            showToast('æ­£åœ¨ç”Ÿæˆ PDF...', 'success');

            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF('landscape', 'mm', 'a4');

            const slides = document.querySelectorAll('.slide');

            for (let i = 0; i < slides.length; i++) {
                if (i > 0) pdf.addPage();

                const canvas = await html2canvas(slides[i], {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: null
                });

                const imgData = canvas.toDataURL('image/jpeg', 0.95);
                pdf.addImage(imgData, 'JPEG', 0, 0, 297, 167);
            }

            pdf.save(`${slidesData[0]?.title || 'presentation'}.pdf`);
            showToast('PDF å¯¼å‡ºæˆåŠŸ!', 'success');
        }

        async function exportImages() {
            showToast('æ­£åœ¨ç”Ÿæˆå›¾ç‰‡...', 'success');

            const slides = document.querySelectorAll('.slide');

            for (let i = 0; i < slides.length; i++) {
                const canvas = await html2canvas(slides[i], {
                    scale: 2,
                    useCORS: true,
                    backgroundColor: null
                });

                const link = document.createElement('a');
                link.download = `slide-${i + 1}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();

                await new Promise(resolve => setTimeout(resolve, 500));
            }

            showToast('å›¾ç‰‡å¯¼å‡ºæˆåŠŸ!', 'success');
        }

        function exportHTML() {
            const slidesHTML = document.getElementById('slides-container').innerHTML;
            const template = templates[currentTemplate];

            const htmlContent = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${slidesData[0]?.title || 'Presentation'}</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans SC', -apple-system, sans-serif;
            background: #1a1a2e;
            padding: 40px;
        }
        .slides-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 40px;
        }
        .slide-wrapper { position: relative; }
        .slide-number {
            position: absolute;
            top: -10px;
            left: 20px;
            background: ${currentColor};
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        .slide {
            width: 100%;
            aspect-ratio: 16/9;
            background: ${template.bgColor};
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }
        .slide-content {
            width: 100%;
            height: 100%;
            padding: 40px 50px;
            color: ${template.textColor};
            display: flex;
            flex-direction: column;
        }
        .slide-cover {
            justify-content: center;
            align-items: center;
            text-align: center;
            background: ${template.titleBg};
            color: white;
        }
        .slide-cover h1 { font-size: 2.5rem; margin-bottom: 16px; }
        .slide-cover .subtitle { font-size: 1.3rem; opacity: 0.8; }
        h2 { font-size: 1.8rem; margin-bottom: 30px; padding-bottom: 15px; border-bottom: 3px solid ${currentColor}; }
        .points { flex: 1; display: flex; flex-direction: column; justify-content: center; gap: 16px; }
        .point { display: flex; align-items: flex-start; gap: 16px; font-size: 1.2rem; }
        .point-icon {
            width: 28px; height: 28px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            background: ${currentColor}; color: white; font-weight: bold; flex-shrink: 0;
        }
    </style>
</head>
<body>
    <div class="slides-container">
        ${slidesHTML}
    </div>
</body>
</html>`;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const link = document.createElement('a');
            link.download = `${slidesData[0]?.title || 'presentation'}.html`;
            link.href = URL.createObjectURL(blob);
            link.click();

            showToast('HTML å¯¼å‡ºæˆåŠŸ!', 'success');
        }

        // UI helpers
        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
            document.getElementById('empty-state').style.display = show ? 'none' : (slidesData.length ? 'none' : 'flex');
            document.getElementById('progress').classList.toggle('active', show);
        }

        function updateProgress(percent, text) {
            document.getElementById('progress-fill').style.width = `${percent}%`;
            document.getElementById('progress-text').textContent = text;
            document.getElementById('loading-text').textContent = text;
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMsg = document.getElementById('toast-message');

            toast.className = `toast ${type}`;
            toastMsg.textContent = message;
            toast.classList.add('show');

            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Close modal on outside click
        document.getElementById('settings-modal').addEventListener('click', (e) => {
            if (e.target.classList.contains('modal-overlay')) {
                closeSettings();
            }
        });
    </script>
</body>
</html>
